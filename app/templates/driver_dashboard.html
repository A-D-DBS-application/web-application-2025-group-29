{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h4 mb-0">Chauffeur Dashboard</h2>
    </div>
    
    <div class="card shadow-sm mb-4 card-primary">
      <div class="card-header card-header-primary">
        <h5 class="mb-0">Mijn Ritten</h5>
      </div>
      <div class="card-body">
        {% if active_orders %}
          <div class="row g-3">
            {% for order in active_orders %}
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 card-primary">
                <div class="card-header card-header-primary">
                  <h6 class="mb-0">Rit #{{ order.id }}</h6>
                </div>
                <div class="card-body">
                  <p class="mb-2">
                    <strong>Deadline:</strong><br>
                    {% if order.deadline %}
                      <span class="text-dark">
                        {{ order.deadline }}
                      </span>
                    {% else %}
                      <span class="text-muted">Geen deadline</span>
                    {% endif %}
                  </p>
                  <p class="mb-2">
                    <strong>Taak:</strong> <span class="badge border border-dark text-dark">{{ order.task_type|default('-') }}</span>
                  </p>
                  <p class="mb-2">
                    <strong>Product:</strong> {{ order.product_type|default('-') }}
                  </p>
                  {% if order.weight %}
                  <p class="mb-2">
                    <strong>Gewicht:</strong> {{ '%.0f'|format(order.weight) }} kg
                  </p>
                  {% endif %}
                  {% if order.work_time_hours is defined %}
                  <p class="mb-2">
                    <strong>Tijdsduur:</strong> {{ '%.2f'|format(order.work_time_hours) }} uur
                  </p>
                  {% endif %}
                  {% if order.address %}
                  <hr>
                  <p class="mb-1"><strong>Adres:</strong></p>
                  <p class="mb-2">
                    {{ order.address.street_name }} {{ order.address.house_number }}<br>
                    {{ order.address.city }}
                  </p>
                  {% if order.address.phone_number %}
                  <p class="mb-2">
                    <strong>Tel:</strong> {{ order.address.phone_number }}
                  </p>
                  {% endif %}
                  {% endif %}
                  {% if order.address %}
                  <div class="d-grid mt-3">
                    {% set full_address = order.address.street_name ~ ' ' ~ order.address.house_number ~ ', ' ~ order.address.city %}
                    <a 
                      href="https://www.google.com/maps/dir/?api=1&destination={{ full_address|replace(' ', '+') }}" 
                      target="_blank" 
                      class="btn btn-primary-custom mb-2"
                    >
                      Navigeer naar Google Maps
                    </a>
                    {% if order.status != 'completed' %}
                    <form method="POST" action="{{ url_for('routes.driver_complete_order', order_id=order.id) }}">
                        <button type="submit" class="btn btn-dark w-100">
                        Taak voltooien
                        </button>
                    </form>
                    {% else %}
                    <span class="badge bg-light text-dark border w-100 p-2 text-center">Uitgevoerd</span>
                    {% endif %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-5">
            <p class="text-muted mb-0">Er zijn nog geen actieve ritten gepland.</p>
          </div>
        {% endif %}
      </div>
    </div>
    
    <div class="card shadow-sm mb-4">
      <div class="card-header card-border-primary">
        <h5 class="mb-0">Voltooide Ritten</h5>
      </div>
      <div class="card-body">
        {% if completed_orders %}
          <div class="row g-3">
            {% for order in completed_orders %}
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 card-primary">
                <div class="card-header card-border-primary">
                  <h6 class="mb-0">Rit #{{ order.id }}</h6>
                </div>
                <div class="card-body">
                  <p class="mb-2">
                    <strong>Deadline:</strong><br>
                    {% if order.deadline %}
                      <span class="text-dark">
                        {{ order.deadline }}
                      </span>
                    {% else %}
                      <span class="text-muted">Geen deadline</span>
                    {% endif %}
                  </p>
                  <p class="mb-2">
                    <strong>Taak:</strong> <span class="badge border border-dark text-dark">{{ order.task_type|default('-') }}</span>
                  </p>
                  <p class="mb-2">
                    <strong>Product:</strong> {{ order.product_type|default('-') }}
                  </p>
                  {% if order.weight %}
                  <p class="mb-2">
                    <strong>Gewicht:</strong> {{ '%.0f'|format(order.weight) }} kg
                  </p>
                  {% endif %}
                  {% if order.work_time_hours is defined %}
                  <p class="mb-2">
                    <strong>Tijdsduur:</strong> {{ '%.2f'|format(order.work_time_hours) }} uur
                  </p>
                  {% endif %}
                  {% if order.address %}
                  <hr>
                  <p class="mb-1"><strong>Adres:</strong></p>
                  <p class="mb-2">
                    {{ order.address.street_name }} {{ order.address.house_number }}<br>
                    {{ order.address.city }}
                  </p>
                  {% if order.address.phone_number %}
                  <p class="mb-2">
                    <strong>Tel:</strong> {{ order.address.phone_number }}
                  </p>
                  {% endif %}
                  {% endif %}
                  <div class="d-grid mt-3">
                    <span class="badge bg-light text-dark border w-100 p-2 text-center">Uitgevoerd</span>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-5">
            <p class="text-muted mb-0">Er zijn nog geen voltooide ritten.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

